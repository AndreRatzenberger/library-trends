# Deep Dive: Grammar-Guided Decoding Primitives

## Focus\n- Earley/PEG/GLR parsers as agent primitives for constrained decoding and structured tool invocation.\n\n## Signals\n- Lark (Earley/GLR; Python): https://github.com/lark-parser/lark — mature, transform-first, ambiguous parse support.\n- GreynirServer (Icelandic parsing server): https://github.com/mideind/GreynirServer — serverized CFG pipeline suggests API shape for grammar endpoints.\n- Blark (Earley-based toy parser): https://github.com/klauer/blark — minimal example for custom grammars.\n\n## Strengths\n- Deterministic schema adherence via grammar; natural fit for tool schemas and JSON/YAML/XML outputs.\n- Ambiguity handling (Earley/GLR) enables robust partial parsing during generation.\n\n## Limits\n- Latency: full parse per token can be heavy without incremental support.\n- Integration: few off-the-shelf bridges from parser state to LM logits.\n\n## What’s Missing\n- Streaming grammar overlays for mid-turn constraint changes.\n- Incremental parser hooks to mask tokens from LM vocabulary in real time.\n- Multi-grammar arbitration for action selection.\n\n## Why Now\n- Rising demand for safety/structure; decoding-time controls beat post-hoc validators.\n\n## Next\n- Prototype: thin adapter exposing parser state → token-mask for major LMs; demo dynamic grammar swap mid-generation.\n